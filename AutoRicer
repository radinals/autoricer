#!/usr/bin/env bash

# TODO:
# - Add something that shows the progress
# - be able to toggle the build info prompt on/off
# - be able to toggle the auto git pull off
# - remove the git pull hint prompt, and make it auto overwrite the previous repository
# BUGS:
# gnu tls failes when git pulling

GitRepoList=("https://github.com/radinals/dwm.git"
    "https://github.com/radinals/dwmblocks.git"
    "https://github.com/radinals/dmenu.git"
    "https://github.com/radinals/st.git"
    "https://github.com/fulhax/ncpamixer"
    "https://github.com/himdel/hsetroot.git"
    "https://github.com/neovim/neovim.git")

BuildDeps=("libgdk-pixbuf-xlib-2.0-0"
    "libxinerama-dev"
    "libimlib2-dev"
    "libx11-dev"
    "libxinerama-dev"
    "pkg-config"
    "pulseaudio"
    "libncurses-dev"
    "libpulse-dev"
    "libxft-dev"
    "ninja-build"
    "gettext"
    "libtool"
    "libtool-bin"
    "autoconf"
    "automake"
    "cmake"
    "g++"
    "unzip"
    "curl"
    "doxygen")

echo ${#BuildDeps[@]}

InstallPkg(){ apt-get -y install "$1" >/dev/null 2>&1; }

error(){ printf "%s\n" "##### $1 #####" >&2; exit 1; }

GitCloneRepo(){
    if [ ! -d "$1" ]; then
	printf "%s\n" "Git cloning repository..." && \
	    git clone "$2" "$1" && printf "%s\n" "Repo Cloned..."
    else
	printf "%s\n" "Checking for updates..."
	cd "$1" || exit 1
	git pull
    fi
    printf "\n" 
}

MakePkg(){
    cd "$1" || exit 1
    printf "%s\n" "Building..."
    make >/dev/null 2>&1
    make install >/dev/null
    printf "%s\n" "Build complete..."
    printf "\n" 
}

MakeNvim(){
    cd "$1" || exit 1
    printf "%s\n" "Building neovim stable..."
    git checkout stable
    make CMAKE_BUILD_TYPE=Release 
    make install
    printf "%s\n" "Build complete..."
    printf "\n" 
}

GetProgDeps(){
    DepPkg=$1
	printf "%s\n" "Installing Package Dependencies..."
    InstallPkg "${DepPkg[@]}"
}

GitMakeInstall(){
    ProgRepo="$1"
    ProgDeps="$2"
    SourceDir="/usr/local/src"
    ProgName=$(basename "$ProgRepo" .git)

    [ -z "$ProgName" ] && error "Missing the program name!."
    [ -z "$ProgRepo" ] && error "Missing the program repository link!."

    [ ! -d "$SourceDir" ] && mkdir -p "$SourceDir"

    printf "%s\n" "##### $ProgName #####"
    GetProgDeps "$ProgDeps"
    GitCloneRepo "$SourceDir/$ProgName" "$ProgRepo"

    if [ "$ProgName" == "neovim" ]; then
	MakeNvim "$SourceDir/$ProgName"
    else
	MakePkg "$SourceDir/$ProgName"
    fi
}

InstallGitPkg(){
    for r in "${GitRepoList[@]}"; do
        GitMakeInstall "$r" "${BuildDeps[@]}"
    done
}

# InstallScripts()
# InstallDotfiles()
# InstallWallpapers()
# InstallExtraPkg()

InstallGitPkg
